@startuml 登山者ガイドマッチングドメインモデル
skinparam classAttributeIconSize 0
hide circle
title 登山者ガイドマッチング ドメインモデル（クラス図）

' ====== マスタ・列挙 ======
enum ReservationStatus {
  仮予約
  予約完了
  予約取消
  自動期限切れ
}

enum PublishState {
  公開
  非公開
}

class "難易度(マスタ)" as Difficulty {
  +名称
  +表示順
}

class "言語(マスタ)" as Language {
  +名称
}

' ====== 共通主体とロール ======
class "ユーザー（共通主体）" as User {
  +表示名
  +アバター画像
  +連絡先メール
  +利用言語(優先)
  +連絡先電話
  +作成日時
  +更新日時
}

class "利用者" as Customer <<role>> {
  +ユーザーID
}

class "登山ガイド" as Guide <<role>> {
  +ユーザーID
  +氏名(公開名)
  +性別
  +所属組織
  +活動エリア
  +対応アクティビティ
  +所有資格
  +自己紹介文
  +平均評価値
  +作成日時
  +更新日時
}

' ガイド対応言語（多対多）
class "ガイド対応言語" as GuideLanguage {
  +ガイドID
  +言語コード
}

' ====== ガイドプラン ======
class "ガイドプラン" as GuidePlan {
  +タイトル
  +説明
  +山域
  +開始日
  +終了日
  +日程チップ
  +種類
  +体力レベル
  +技術レベル
  +価格
  +公開フラグ
  +定員
  +集合情報
  +解散場所
  +行程
  +持ち物
  +注意事項
  +支払い方法
  +画像一覧
  +作成日時
  +更新日時
}

' ====== 予約 ======
class "予約（ガイドプラン予約）" as Reservation {
  +予約番号
  +ガイドプランID
  +利用者ID
  +希望日
  +人数
  +概算金額
  +連絡事項
  +ステータス
  +承認期限日時
  +作成日時
  +更新日時
}

' ====== レビュー ======
abstract class "レビュー対象" as ReviewTarget
Guide -up-|> ReviewTarget
GuidePlan -up-|> ReviewTarget

class "レビュー" as Review {
  +対象種別
  +対象ID
  +投稿者ID
  +予約ID
  +評価
  +コメント
  +公開状態
  +公開日時
  +作成日時
  +更新日時
}

' ====== 通知 ======
enum NotificationType {
  予約承認依頼
  承認完了
  却下
  期限切れ
}

enum Channel {
  アプリ内
  メール
}

class "通知" as Notification {
  +対象ユーザーID
  +種別
  +既読
  +送信チャネル
  +関連予約ID
  +作成日時
  +更新日時
}

' ====== 関係（リレーション） ======
User "1" -- "0..1" Customer : ロール
User "1" -- "0..1" Guide : ロール

Guide "1" -- "0..*" GuidePlan : 提供
GuidePlan "1" -- "0..*" Reservation : 受け付け
Customer "1" -- "0..*" Reservation : 申込

Guide "1" -- "0..*" Review : 受領 (targetType='Guide')
GuidePlan "1" -- "0..*" Review : 受領 (targetType='GuidePlan')
Customer "1" -- "0..*" Review : 投稿

User "1" -- "0..*" Notification : 受信

Language "1" -- "0..*" GuideLanguage
Guide "1" -- "0..*" GuideLanguage

Difficulty "1" -- "0..*" GuidePlan : 難易度

' ====== 重要ビジネスルール（メモ） ======
note right of Reservation
- ステータスは {仮予約, 予約完了, 予約取消, 自動期限切れ}
- 起点は常に「仮予約」
- 承認期限日時を過ぎた仮予約は「自動期限切れ」
- 予約完了後のキャンセル可否はMVPで要決定
end note

note bottom of Review
- レビューはガイド or プランのどちらかに紐づく
- 公開状態の制御あり（公開/非公開）
end note
@enduml
